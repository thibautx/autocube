{% extends "page.html" %}
{% set active_page = "garage" %}
{% block title %} Garage {% endblock %}
{% block head %}
{{ super() }}
    {% set active_page = active_page|default('garage') -%}
{% endblock %}
{% block content %}
<div id="add-car-div" align="center">
<form name="add-car" action="{{ url_for('.add_car') }}" method="POST">
    <div class="form-group">
        <label for="make"></label>
        <select id="make" name="make" class="selectpicker" data-live-search="true">
            <option disabled="disabled" selected="selected">Make</option>
        </select>
        <label for="model"></label>
        <select id="model" name="model" class="selectpicker" data-live-search="true">
            <option disabled="disabled" selected="selected">Model</option>
        </select>
        <label for="year"></label>
        <select id="year" name="year" class="selectpicker" data-live-search="true">
            <option disabled="disabled" selected="selected">Year</option>
        </select>
        <button type="submit" class="btn btn-default btn-md">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add Car
        </button>
    </div>
</form>
</div>
<div class="container">
    <div class="panel panel-default">
        <div class="panel-heading">
        <h3 class="panel-title">Your Garage</h3></div>
        {% for car in cars %}
            <div class="panel-body">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Car Info</h3>
                    </div>
                    <div class="panel-body">
                        <div class="col-md-4">
                            <img src="../../static/images/lambo.jpeg" height="100px" width="200px">
                              <a href="{{ url_for('.car_details', id=car.id)}}" class="btn btn-default" role="button">
                                  View Car Information
                              </a>
                        </div>
                        <div class="col-md-4">
                            <h4>{{ car.year }}</h4>
                            <h2>{{ car.make }} {{ car.model }}</h2>
                            Recommended services: <br>
                            Total Mileage: <br>
                            Daily Mileage Average: <br>
                        </div>
                        <div class="col-md-4">RECALLS!!!</div>
                    </div>
                </div>
            </div>
        {% endfor %}
        </div>
    </div>

<div class="modal fade" role="dialog" tabindex="-1" id="recall-details">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                <h4 class="modal-title">Details</h4></div>
            <div class="modal-body" id="recall-details-summary">
            </div>
            <div class="modal-footer">
                <button class="btn btn-default" type="button" data-dismiss="modal">Close</button>
                <button class="btn btn-primary" type="button">Save</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}
{% block scripts %}
<script>
    var make_selector = '#make';
    var model_selector = '#model';
    var year_selector = '#year';

    $(document).ready(function() {


        // Populate make select
        $.each({{makes | safe}}, function(index, make) {
            $(make_selector).append($('<option>').text(make).attr('value', make));
        });

        // When selected make changes, populate model select
        $(make_selector).change(function() {
            var selected_make = this.value;
            $(model_selector).empty();
            $.getJSON("{{ url_for('.models')}}", {
                    make: selected_make
                },
                function(data) {
                    $(model_selector).append($('<option>').text('Model').attr('disabled', 'disabled').attr('selected', 'selected'));
                    $.each(data, function(number, model) {
                        $(model_selector).append($('<option>').text(model).attr('value', model));
                    });
                    $(model_selector).selectpicker('refresh');
                    $(model_selector).selectpicker('render');

                    $(model_selector).change(function() {
                        var selected_model = this.value;
                        $(year_selector).empty();
                        $.getJSON("{{ url_for('.model_years')}}", {
                                make: selected_make,
                                model: selected_model
                            },
                            function(data) {
                                $(year_selector).append($('<option>').text('Year').attr('disabled', 'disabled').attr('selected', 'selected'));
                                $.each(data, function(number, year) {
                                    $(year_selector).append($('<option>').text(year).attr('value', year));
                                });
                                $(year_selector).selectpicker('refresh');
                                $(year_selector).selectpicker('render');
                            }
                        );
                    });
                }
            );
        });


    });
</script>
{% endblock %}
